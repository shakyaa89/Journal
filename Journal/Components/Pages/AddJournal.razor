@page "/journal/add"
@using Project.Models
@inject NavigationManager Navigation

<div class="journal-container">
    <h1>Today’s Journal</h1>

    <div class="form-group">
        <input type="text"
               placeholder="Give today a title..."
               @bind="newJournal.Title" />
    </div>

    <div class="form-group">
        <textarea placeholder="Write freely. No rules. No judgment."
                  @bind="newJournal.Content"></textarea>
    </div>

    <div class="form-group">
        <div class="tag-header">
            <label>Tags:</label>
        </div>
        <hr />
        <div class="tags-container">
            @foreach (var tag in AvailableTags)
            {
                <label class="tag-item">
                    <input type="checkbox"
                           checked="@newJournal.Tags.Contains(tag)"
                           @onchange="(e) => ToggleTag(tag, (bool)e.Value)" />
                    @tag
                </label>
            }
        </div>
    </div>

    <div class="form-group">
        <div class="mood-header">
            <label>Moods</label>
        </div>
        <hr />
        <div class="mood-container">
            @foreach (var mood in MoodsList)
            {
                <label class="tag-item">
                    <input type="radio"
                           name="mood"
                           checked="@(newJournal.Mood == mood)"
                           @onchange="() => newJournal.Mood = mood" />
                    @mood
                </label>
            }
        </div>
    </div>

    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <p class="error-msg">@errorMessage</p>
    }

    <div class="button-group">
        <button class="btn secondary-btn" @onclick="GoToList">Back</button>
        <button class="btn primary-btn" @onclick="SaveEntry">Save Entry</button>
    </div>
</div>

@if (Journal.Journals.Count > 0)
{
    <div class="add-journal">

    
        <h2 class="journal-list-title">Your Journals</h2>
        <ul class="journal-items">
            @foreach (var journal in Journal.Journals)
            {
                <li class="journal-item">
                    <div class="journal-header">
                        <strong>@journal.Title</strong>
                        <span class="journal-date">
                            @journal.CreatedAt.ToString("dddd, MMM dd, yyyy")
                        </span>
                    </div>

                    @if (!string.IsNullOrEmpty(journal.Mood))
                    {
                        <div class="journal-mood">
                            Mood: <span class="mood">@journal.Mood</span>
                        </div>
                    }

                    @if (journal.Tags.Any())
                    {
                        <div class="journal-tags">
                            @foreach (var tag in journal.Tags)
                            {
                                <span class="tag">@tag</span>
                            }
                        </div>
                    }
                    <hr />
                    <p>@journal.Content</p>
                </li>
            }
        </ul>
    </div>
}




@code {
    private Journal newJournal = new Journal();
    private string errorMessage = string.Empty;

    private List<string> AvailableTags = new List<string> {"Work", "Career", "Studies", "Family", "Friends", "Relationships", "Health", "Fitness", "Personal Growth", "Self-care", "Hobbies", "Travel", "Nature", "Finance", "Spirituality", "Birthday", "Holiday", "Vacation", "Celebration", "Exercise", "Reading", "Writing", "Cooking", "Meditation", "Yoga", "Music", "Shopping", "Parenting", "Projects", "Planning", "Reflection"};

    private List<string> MoodsList = new List<string> { "Happy", "Excited", "Relaxed", "Grateful", "Confident", "Calm", "Thoughtful", "Curious", "Nostalgic", "Bored", "Sad", "Angry", "Stressed", "Lonely", "Anxious" };


    private void SaveEntry()
    {

        var today = DateTime.Now.Date;
        bool existsToday = Journal.Journals.Exists(j => j.CreatedAt.Date == today);

        if (existsToday)
        {
            errorMessage = "You can only create one journal entry per day.";
            return;
        }

        if (string.IsNullOrWhiteSpace(newJournal.Mood))
        {
            errorMessage = "Please select a mood.";
            return;
        }

        if (!string.IsNullOrWhiteSpace(newJournal.Title) && !string.IsNullOrWhiteSpace(newJournal.Content))
        {
            newJournal.CreateJournalEntry();
            newJournal = new Journal(); 
            errorMessage = string.Empty;
        }

    }

    private void GoToList()
    {
        Navigation.NavigateTo("/journal/list");
    }

    private void ToggleTag(string tag, bool isChecked)
    {
        if (isChecked)
        {
            if (!newJournal.Tags.Contains(tag))
                newJournal.Tags.Add(tag);
        }
        else
        {
            newJournal.Tags.Remove(tag);
        }
    }

}
