@page "/journal/list"
@using Journal.Models
@using Journal.Services
@inject JournalService JournalService;
@inject AuthService AuthService;
@inject NavigationManager Navigation;

<div class="journal-list-page">
    <div class="list-header">
        <h1>Your Journal Entries</h1>
        <p class="header-subtitle">@journals?.Count @(journals?.Count == 1 ? "entry" : "entries") total</p>
    </div>

    @if (journals?.Count == 0)
    {
        <div class="empty-state">
            <div class="empty-icon">📝</div>
            <h2>No journal entries yet</h2>
            <p>Start documenting your thoughts and experiences</p>
            <a href="/journal/add" class="btn-add-first">Create Your First Entry</a>
        </div>
    }
    else
    {
        <div class="journal-grid">
            @foreach (var journal in journals!)
            {
                <div class="journal-card">
                    <div class="card-top">
                        <div class="journal-date-badge">
                            <span class="date-day">@journal.CreatedAt.ToString("dd")</span>
                            <span class="date-month">@journal.CreatedAt.ToString("MMM")</span>
                        </div>
                        @if (!string.IsNullOrEmpty(journal.Mood))
                        {
                            <div class="mood-badge">
                                <span class="mood-emoji">😊</span>
                                <span class="mood-text">@journal.Mood</span>
                            </div>
                        }
                    </div>

                    <h3 class="journal-title">@journal.Title</h3>

                    <p class="journal-preview">@GetPreview(journal.Content)</p>

                    <div class="card-footer">
                        <span class="journal-time">@journal.CreatedAt.ToString("h:mm tt")</span>
                        <button class="btn-read-more" @onclick="() => ViewJournal(journal.Id)">Read More →</button>
                    </div>
                </div>
            }
        </div>
    }

    <div class="floating-add-btn">
        <a href="/journal/add" class="btn-add-new">
            <span class="add-icon">+</span>
            <span>New Entry</span>
        </a>
    </div>
</div>

@code {
    private User? currentUser;
    private List<JournalEntry>? journals = new List<JournalEntry>();

    protected async override Task OnInitializedAsync()
    {
        currentUser = AuthService.GetCurrentUser();
        if (currentUser == null)
        {
            Navigation.NavigateTo("/login");
            return;
        }
        await FetchJournalsAsync();
    }

    private async Task FetchJournalsAsync()
    {
        if (currentUser != null)
        {
            journals = await JournalService.GetAllJournalsAsync(currentUser.Id);
        }
    }

    private string GetPreview(string content)
    {
        if (string.IsNullOrEmpty(content)) return "";
        return content.Length > 150 ? content.Substring(0, 150) + "..." : content;
    }

    private void ViewJournal(int id)
    {
        // Navigation.NavigateTo($"/journal/view/{id}");
    }
}